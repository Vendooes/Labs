import numpy as np
import matplotlib.pyplot as plt

# Данные из таблиц
data = {
    2.4: {
        'U_нак': 3.41,
        'Ua_Ia': {
            1: 17.00, 2: 36.00, 3: 46.00, 4: 47.00, 5: 48.00,
            10: 51.00, 20: 53.00, 30: 55.00
        }
    },
    2.5: {
        'U_нак': 3.73,
        'Ua_Ia': {
            1: 23.00, 2: 52.00, 3: 79.00, 4: 82.00, 5: 83.00,
            10: 86.00, 20: 90.00, 30: 92.00
        }
    },
    2.6: {
        'U_нак': 4.12,
        'Ua_Ia': {
            1: 43.00, 2: 111.00, 3: 203.00, 4: 280.00, 5: 334.00,
            10: 350.00, 20: 367.00, 30: 378.00
        }
    },
    2.7: {
        'U_нак': 4.34,
        'Ua_Ia': {
            1: 70.00, 2: 164.00, 3: 264.00, 4: 437.00, 5: 595.00,
            10: 1273.00, 20: 1356.00, 30: 1402.00, 40: 1455.00, 50: 1617.00,
            70: 1700.00, 90: 1750.00, 100: 1780.00, 130: 1860.00
        }
    },
    2.8: {
        'U_нак': 4.66,
        'Ua_Ia': {
            1: 75.00, 2: 178.00, 3: 313.00, 4: 475.00, 5: 660.00,
            10: 1970.00, 20: 3910.00, 26: 4070.00, 50: 4740.00, 70: 4930.00,
            90: 5230.00, 100: 5360.00, 110: 5550.00, 120: 5660.00, 130: 6170.00, 140: 6210.00
        }
    },
    2.9: {
        'U_нак': 5.09,
        'Ua_Ia': {
            1: 90.00, 2: 200.00, 3: 330.00, 4: 510.00, 5: 720.00,
            10: 2150.00, 20: 6170.00, 30: 9010.00, 40: 13700.00, 50: 14400.00,
            60: 14650.00, 70: 14790.00, 80: 14860.00, 90: 14900.00, 100: 14900.00, 130: 15000.00
        }
    }
}

# Выбираем несколько значений анодного напряжения для построения графиков
selected_Ua = [1, 5, 10, 20, 30, 50, 100]

plt.figure(figsize=(12, 8))

# Для каждого выбранного анодного напряжения строим зависимость
for Ua in selected_Ua:
    I_нак_list = []
    log_Ia_list = []
    
    # Собираем данные для текущего Ua
    for I_нак, values in data.items():
        if Ua in values['Ua_Ia']:
            I_нак_list.append(I_нак)
            Ia = values['Ua_Ia'][Ua]
            # Вычисляем логарифм анодного тока (в мкА)
            log_Ia = np.log10(Ia)
            log_Ia_list.append(log_Ia)
    
    # Сортируем данные по току накала для правильного построения графика
    sorted_indices = np.argsort(I_нак_list)
    I_нак_sorted = [I_нак_list[i] for i in sorted_indices]
    log_Ia_sorted = [log_Ia_list[i] for i in sorted_indices]
    
    # Строим график для данного Ua
    if len(I_нак_sorted) > 0:
        plt.plot(I_нак_sorted, log_Ia_sorted, 'o-', linewidth=2, markersize=6, label=f'Uₐ = {Ua} В')

plt.xlabel('Ток накала Iₕ, А')
plt.ylabel('lg(Iₐ), где Iₐ в мкА')
plt.title('Зависимость анодного тока от тока накала при различных анодных напряжениях')
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)

# Добавляем сетку для логарифмической оси Y
plt.gca().yaxis.set_major_locator(plt.MultipleLocator(0.5))
plt.gca().yaxis.set_minor_locator(plt.MultipleLocator(0.1))

plt.tight_layout()
plt.show()

# Дополнительный анализ: построим таблицу значений
print("ЗАВИСИМОСТЬ АНОДНОГО ТОКА ОТ ТОКА НАКАЛА")
print("=" * 70)
print("Uₐ [В] | Iₕ [А] -> Iₐ [мкА] (lg(Iₐ))")
print("-" * 70)

for Ua in selected_Ua:
    print(f"{Ua:6} | ", end="")
    for I_нак, values in data.items():
        if Ua in values['Ua_Ia']:
            Ia = values['Ua_Ia'][Ua]
            log_Ia = np.log10(Ia)
            print(f"{I_нак}: {Ia:.0f} ({log_Ia:.2f})  ", end="")
    print()

# Анализ результатов
print("\nАНАЛИЗ РЕЗУЛЬТАТОВ")
print("=" * 50)
print("1. С увеличением тока накала анодный ток увеличивается")
print("2. Зависимость lg(Iₐ) от Iₕ близка к линейной")
print("3. Чем выше анодное напряжение, тем больше анодный ток при том же токе накала")
print("4. При малых Uₐ (1-5 В) зависимость более слабая")
print("5. При больших Uₐ (20-100 В) наблюдается более сильная зависимость")
print("6. Это объясняется увеличением термоэлектронной эмиссии с ростом температуры катода")